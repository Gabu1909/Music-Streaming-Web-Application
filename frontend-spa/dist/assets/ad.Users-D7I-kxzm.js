import{E as u}from"./EntityTable-N9abvo81.js";import{K as c,N as i,_ as h,c as m,l as g,O as f,D as y,o as p}from"./index-CFB-G1Nn.js";const n="http://localhost:3000/api/users",d={async getAll(e={}){try{const t=new URLSearchParams(e).toString(),s=t?`${n}?${t}`:n,a=await c(s,{method:"GET",headers:i.getAuthHeaders()});return console.log("Users fetched:",a),a}catch(t){throw console.error("fetch users failed:",t),t}},async getById(e){try{return await c(`${n}/${e}`,{method:"GET",headers:i.getAuthHeaders()})}catch(t){throw console.error(`fetch user ${e} failed:`,t),t}},async create(e){try{const t=e instanceof FormData?e:Object.keys(e).reduce((o,r)=>(e[r]!=null&&o.append(r,e[r]),o),new FormData),s=i.getAuthHeaders();t instanceof FormData&&delete s["Content-Type"];const a=await c(n,{method:"POST",body:t,headers:s});return console.log("User created:",a),a}catch(t){throw console.error("create user failed:",t),t}},async update(e,t){try{const s=t instanceof FormData?t:Object.keys(t).reduce((r,l)=>(t[l]!=null&&r.append(l,t[l]),r),new FormData),a=i.getAuthHeaders();s instanceof FormData&&delete a["Content-Type"];const o=await c(`${n}/${e}`,{method:"PUT",body:s,headers:a});return console.log("User updated:",o),o}catch(s){throw console.error(`update user ${e} failed:`,s),s}},async delete(e){try{const t=await c(`${n}/${e}`,{method:"DELETE",headers:i.getAuthHeaders()});return console.log("User deleted:",t),t}catch(t){throw console.error(`delete user ${e} failed:`,t),t}}},_={name:"Users",components:{EntityTable:u},data(){return{users:[],tableConfig:{entityName:"users",searchPlaceholder:"Search users by username, email...",emptyMessage:"No users found.",showPlayButton:!1,itemsPerPage:15,searchableColumns:["username","email","role"],columns:[{key:"avatar_url",label:"Avatar",type:"avatar",sortable:!1},{key:"user_id",label:"ID",type:"text",sortable:!0,maxLength:10},{key:"username",label:"Username",type:"text",sortable:!0,maxLength:20},{key:"email",label:"Email",type:"text",sortable:!0,maxLength:35},{key:"role",label:"Role",type:"badge",sortable:!0},{key:"created_at",label:"Joined",type:"date",sortable:!0},{key:"actions",label:"Actions",type:"actions",sortable:!1,maxLength:0}]}}},methods:{async fetchUsers(){try{console.log("Fetching users from API...");const e=await d.getAll();console.log("Raw API Response:",e);let t=[];e&&e.status==="success"&&e.data?Array.isArray(e.data)?t=e.data:e.data.users&&Array.isArray(e.data.users)?t=e.data.users:e.data.data&&Array.isArray(e.data.data)&&(t=e.data.data):Array.isArray(e)&&(t=e),this.users=t.map(s=>({user_id:s.user_id||s.id,username:s.username||s.name||"Unknown",email:s.email||"No email",avatar_url:s.avatar_url?`/public/uploads/images${s.avatar_url}`:null,role:s.role||"user",created_at:s.created_at,password_hash:void 0})),console.log("Users loaded successfully:",this.users.length),this.users.length>0&&console.log("First user example:",this.users[0])}catch(e){console.error("Error fetching users:",e),this.users=[];const t=e.response?.data?.message||e.response?.data?.error||e.message||"Failed to connect to server";console.warn(`Failed to load users: ${t}`)}},viewUser(e){console.log("Viewing user details:",e.username);const t=e.created_at?new Date(e.created_at).toLocaleDateString():"Unknown",s=`User Details:

ID: ${e.user_id}
Username: ${e.username}
Email: ${e.email}
Role: ${e.role}
Avatar: ${e.avatar_url?"Yes":"No"}
Joined: ${t}`;alert(s)},async deleteUser(e){const t=`Are you sure you want to delete user "${e.username}"?

This action cannot be undone.`;if(confirm(t))try{console.log("Deleting user:",e.username),await d.delete(e.user_id),this.users=this.users.filter(s=>s.user_id!==e.user_id),console.log("User deleted successfully"),alert(`User "${e.username}" has been deleted successfully.`),await this.fetchUsers()}catch(s){console.error("Error deleting user:",s);const a=s.response?.data?.message||s.message;alert(`Failed to delete user: ${a}`),await this.fetchUsers()}}},mounted(){console.log("Users component mounted"),console.log("Available APIs:",{usersService:d}),this.fetchUsers()}},w={class:"users-page"};function b(e,t,s,a,o,r){const l=y("EntityTable");return p(),m("div",w,[g(l,f(o.tableConfig,{rows:o.users,onDelete:r.deleteUser,onView:r.viewUser}),null,16,["rows","onDelete","onView"])])}const $=h(_,[["render",b]]);export{$ as default};
