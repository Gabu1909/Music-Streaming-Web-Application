import{_ as q,s as M,u as N,h as d,x as B,I as D,E as T,j as g,c,a as s,b as h,e as _,v as y,z as A,o as v,M as P}from"./index-BH3AGQtF.js";const L={class:"settings-container"},Q={key:0,class:"loading"},R={key:1,class:"error"},V={key:2,class:"settings-form"},j={class:"form-group"},z={class:"form-group"},K={class:"form-group"},G={class:"avatar-container"},H=["src"],J={class:"form-actions"},O=["disabled"],w="uploads/img/default-avatar.jpg",W={__name:"Setting",setup(X){const m=A(),b=M(),{userId:t,showToast:l,validateEmail:I}=N(),o=d(""),r=d(""),u=d(null),f=d(null),{data:n,isLoading:k,isError:C}=B({queryKey:["user",t],queryFn:async()=>{if(!t.value)throw new Error("No user ID");const e=await P.getUser();if(e.status==="success"&&e.data?.user_id)return e.data;throw new Error("Invalid user data")},enabled:!!t.value});D(n,e=>{e&&(o.value=e.username||e.email||"User",r.value=e.email||"",f.value=e.avatar_url||w)},{immediate:!0});const E=e=>{const a=e.target.files[0];if(!a)return;if(!a.type.match("image.*")){l("Please select a valid image file","error");return}if(a.size>2*1024*1024){l("Image must not exceed 2MB","error");return}u.value=a;const i=new FileReader;i.onload=U=>{f.value=U.target.result},i.readAsDataURL(a)},p=T({mutationFn:async e=>{if(!t.value)throw new Error("No user ID");return console.log("Calling updateProfile with userId:",t.value),await P.updateProfile(t.value,e)},onSuccess:e=>{console.log("Profile update success:",e),e?.status==="success"?(l("ðŸŽ‰ Profile updated successfully!","success"),b.invalidateQueries({queryKey:["user",t.value]}),setTimeout(()=>m.push("/"),1500)):l(e?.message||"Profile update failed","error")},onError:e=>{console.log("Profile update error:",e);let a="Profile update failed";e.message.includes("Failed to fetch")?a="Network error: Unable to reach the server":e.message.includes("No token found")?a="Please log in again":a=e.message||a,l(a,"error")}}),F=()=>{if(console.log("Token:",localStorage.getItem("token")),console.log("UserId:",t.value),!t.value){l("User ID not found","error");return}if(!o.value||!r.value){l("Please fill in all required fields","error");return}if(!I(r.value)){l("Invalid email format","error");return}const e=new FormData;e.append("username",o.value),e.append("email",r.value),u.value&&e.append("avatar_url",u.value),p.mutate(e)},x=()=>{m.push("/")},S=g(()=>n.value?o.value!==(n.value.username||n.value.email||"User")||r.value!==(n.value.email||"")||u.value!==null:!1);return g(()=>p.isPending),(e,a)=>(v(),c("div",L,[a[5]||(a[5]=s("h1",{class:"settings-title"},"Profile Settings",-1)),h(k)?(v(),c("div",Q,"Loading profile...")):h(C)?(v(),c("div",R,"Failed to load profile. Please try again.")):(v(),c("div",V,[s("div",j,[a[2]||(a[2]=s("label",{for:"username"},"Username",-1)),_(s("input",{id:"username","onUpdate:modelValue":a[0]||(a[0]=i=>o.value=i),type:"text",placeholder:"Enter your username",class:"form-input"},null,512),[[y,o.value]])]),s("div",z,[a[3]||(a[3]=s("label",{for:"email"},"Email",-1)),_(s("input",{id:"email","onUpdate:modelValue":a[1]||(a[1]=i=>r.value=i),type:"email",placeholder:"Enter your email",class:"form-input"},null,512),[[y,r.value]])]),s("div",K,[a[4]||(a[4]=s("label",{for:"avatar"},"Profile Picture",-1)),s("div",G,[s("img",{src:f.value||w,alt:"Profile Picture Preview",class:"avatar-preview"},null,8,H),s("input",{id:"avatar",type:"file",accept:"image/*",onChange:E,class:"avatar-input"},null,32)])]),s("div",J,[s("button",{disabled:!S.value,onClick:F,class:"save-btn"}," Save Changes ",8,O),s("button",{onClick:x,class:"cancel-btn"},"Cancel")])]))]))}},Z=q(W,[["__scopeId","data-v-bc9532f5"]]);export{Z as default};
