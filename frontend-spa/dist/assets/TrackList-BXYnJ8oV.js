import{_ as B,g as $,j as E,c as r,o as a,l as V,p as I,d as T,H as L,a as s,f as y,T as N,h,m as z,F as P,q as j,n as x,t as k,w as C,b as D}from"./index-CFB-G1Nn.js";const F={class:"options-menu-container"},Q={__name:"TrackOptionsMenu",props:{isVisible:Boolean,position:Object,track:Object},emits:["select","close"],setup(c,{emit:g}){const i=c,u=g,p=$(),f=E(()=>p.playlist.some(l=>(l.song_id||l.id)===(i.track.song_id||i.track.id))),d=async l=>{u("select",{option:l,track:i.track}),u("close")};return(l,n)=>(a(),r("div",F,[V(N,{name:"fade"},{default:I(()=>[c.isVisible?(a(),r("div",{key:0,class:"options-menu",style:L({top:`${c.position.y}px`,left:`${c.position.x}px`})},[f.value?(a(),r("div",{key:1,class:"menu-item",onClick:n[1]||(n[1]=v=>d("remove-from-queue"))},n[4]||(n[4]=[s("i",{class:"fas fa-trash-alt"},null,-1),y(" Xóa khỏi hàng đợi ")]))):(a(),r("div",{key:0,class:"menu-item",onClick:n[0]||(n[0]=v=>d("add-to-queue"))},n[3]||(n[3]=[s("i",{class:"fas fa-list"},null,-1),y(" Thêm vào hàng đợi ")]))),s("div",{class:"menu-item",onClick:n[2]||(n[2]=v=>d("download"))},n[5]||(n[5]=[s("i",{class:"fas fa-download"},null,-1),y(" Tải về ")]))],4)):T("",!0)]),_:1})]))}},R=B(Q,[["__scopeId","data-v-787ff3f1"]]),A={class:"track-list"},H=["onClick"],U={class:"track-index"},X={class:"position"},G=["onClick"],J={class:"track-info"},K={class:"track-title"},W={key:0,class:"explicit-badge"},Y={class:"track-artist"},Z={class:"track-duration"},tt=["onClick"],st={__name:"TrackList",props:{tracks:{type:Array,required:!0}},setup(c){const g=c,i=$(),u=h(!1),p=h({x:0,y:0}),f=h(null),d=o=>{const t=o.song_id||o.id;return i.currentTrack?.id===t},l=async o=>{const t=await i.normalizeSongData(o);if(!t.audioUrl){console.error("No audio URL for track:",t);return}d(t)?await i.togglePlay():await i.playSong(t,g.tracks)},n=(o,t)=>{f.value=t;const e=o.currentTarget.getBoundingClientRect(),_=150,m=8,O=e.left;let b=e.top-_-m;b<0&&(b=e.bottom+m),p.value={x:O,y:b},u.value=!0;const w=q=>{q.target.closest(".options-menu")||(u.value=!1,document.removeEventListener("click",w))};document.addEventListener("click",w)},v=async({option:o,track:t})=>{try{switch(o){case"add-to-queue":await i.addToQueue(t);break;case"remove-from-queue":await i.removeFromQueue(t);break;case"download":S(t);break}}catch(e){console.error("Error handling menu option:",e)}},S=o=>{if(!o.audio_url)return;const t=document.createElement("a");t.href=o.audio_url,t.download=`${o.title}.mp3`,document.body.appendChild(t),t.click(),document.body.removeChild(t)},M=o=>{if(!o)return"0:00";const t=Math.floor(o/60),e=Math.floor(o%60).toString().padStart(2,"0");return`${t}:${e}`};return(o,t)=>(a(),r("div",A,[t[2]||(t[2]=s("div",{class:"track-list-header"},[s("div",null,"#"),s("div",null,"Title"),s("div",null,"Artist"),s("div",null,[s("i",{class:"fas fa-clock"})])],-1)),(a(!0),r(P,null,j(c.tracks,(e,_)=>(a(),r("div",{key:e.song_id||e.id,class:x([{active:d(e)},"track-item"]),onClick:m=>l(e)},[s("div",U,[s("span",X,k(_+1),1),s("button",{class:"play-btn",onClick:C(m=>l(e),["stop"])},[s("i",{class:x(d(e)&&D(i).isPlaying?"fas fa-pause":"fas fa-play")},null,2)],8,G)]),s("div",J,[s("span",K,k(e.title),1),e.explicit?(a(),r("span",W,"E")):T("",!0)]),s("div",Y,k(e.artist),1),s("div",Z,[y(k(M(e.duration))+" ",1),s("button",{class:"more-btn",onClick:C(m=>n(m,e),["stop"])},t[1]||(t[1]=[s("i",{class:"fas fa-ellipsis-h"},null,-1)]),8,tt)])],10,H))),128)),u.value?(a(),z(R,{key:0,"is-visible":u.value,position:p.value,track:f.value,onSelect:v,onClick:t[0]||(t[0]=C(()=>{},["stop"]))},null,8,["is-visible","position","track"])):T("",!0)]))}};export{st as _};
