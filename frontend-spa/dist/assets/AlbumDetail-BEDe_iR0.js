import{_ as C,b as E,u as M,l as b,x as T,e as U,D as q,c as n,g as e,a as t,t as B,i as L,j as R,f as g,A as N,o,M as V,E as f}from"./index-CJw3wfj_.js";import{_ as $}from"./TrackList-LyJ0AD-6.js";const j={class:"album-detail"},K={key:0,class:"loading"},I={key:1,class:"error"},Q={key:2,class:"album-container"},z={class:"album-header"},G={class:"album-content"},H={__name:"AlbumDetail",setup(J){const l=T(),i=E(null),{currentSong:k,initAudio:v,playSong:u}=M(),{data:r,isLoading:h,error:d,refetch:A}=b({queryKey:["album",l.params.id],queryFn:async()=>(await f.getAlbumDetails(l.params.id)).data?.album||{},onError:a=>{console.error("Failed to fetch album details:",a)}}),{data:c,isLoading:S,error:m,refetch:w}=b({queryKey:["albumSongs",l.params.id],queryFn:async()=>(await f.getAlbumSongs(l.params.id)).data?.songs||[],onError:a=>{console.error("Failed to fetch album songs:",a)}}),D=a=>a?`/${a.replace(/^public\//,"")}`:"/default-album.jpg",p=a=>a.audio_url?`/${a.audio_url.replace(/^public\//,"")}`:"",_=async()=>{const a=(c.value||[]).map(s=>({...s,audioUrl:p(s)}));a.length&&await u(a[0],a)},F=async a=>{const s=(c.value||[]).map(y=>({...y,audioUrl:p(y)}));await u(a,s)},P=a=>{console.log("Track options:",a)},x=async()=>{await Promise.all([A(),w()])};return U(async()=>{await q(),i.value&&v(i.value)}),(a,s)=>(o(),n("div",j,[e(h)||e(S)?(o(),n("div",K,s[0]||(s[0]=[t("div",{class:"spinner"},null,-1),t("p",null,"Loading album details...",-1)]))):e(d)||e(m)?(o(),n("div",I,[t("p",null,B(e(d)?.message||e(m)?.message||"Failed to load album data"),1),t("button",{onClick:x,class:"retry-btn"},"Retry")])):(o(),n("div",Q,[t("div",z,[g(N,{title:e(r).title||"Untitled Album",artist:e(r).artist_name||"Unknown Artist",cover_url:D(e(r).cover_url),songData:e(r).songs,onClick:_,onPlay:_},null,8,["title","artist","cover_url","songData"])]),t("div",G,[s[1]||(s[1]=t("h2",null,"Tracks",-1)),g($,{tracks:e(c)||[],onMore:P,onPlay:F},null,8,["tracks"])]),t("audio",{ref_key:"audioRef",ref:i,preload:"metadata"},null,512),e(k)?(o(),L(V,{key:0})):R("",!0)]))]))}},X=C(H,[["__scopeId","data-v-cee837e9"]]);export{X as default};
