import{_ as D,s as G,g as B,h as v,x as K,j as P,E as W,c as i,o as n,a as s,e as U,d as m,v as M,t as g,b as C,F as S,q as A,G as H,z as J,k as X,m as E,f as Z}from"./index-DTmEoMLP.js";import{p as N,P as x}from"./PlaylistCard-BFZCcWWa.js";import{S as ee}from"./song.service-C1QnVOq0.js";/* empty css                                                                     */const se="/uploads/img/playlist-banner.jpg",le={class:"modal"},te={class:"modal-content"},ae={class:"cover-upload"},ne={key:0,class:"cover-preview"},oe={key:1,class:"cover-success"},ie={class:"song-selection"},re={key:0,class:"song-count"},ue={key:1,class:"song-count"},ce={class:"song-search"},de={class:"song-list"},ve={key:0,class:"loading-state"},ge={key:1,class:"error-message"},ye={key:2,class:"no-songs"},pe={key:3,class:"song-list-items"},me=["value"],fe={key:2,class:"selected-songs"},_e={class:"selected-list"},he=["onClick"],Pe={key:0,class:"error-message"},Ce={class:"modal-actions"},ke=["disabled"],be={__name:"CreatePlaylistModal",emits:["close","create"],setup(T,{emit:I}){const k=I;J();const f=G(),_=B(),d=v(""),p=v(""),u=v([]),y=v(null),c=v(null),h=v(null),r=v(!1),l=v(!1),{data:a,isLoading:b,error:w}=K({queryKey:["songs"],queryFn:async()=>{console.log("Fetching songs from API...");const t=await ee.getSongs();console.log("Raw API response:",t);let e=[];if(Array.isArray(t))e=t;else if(t.status==="success"&&Array.isArray(t.data))e=t.data;else if(t.status==="success"&&t.data&&Array.isArray(t.data.songs))e=t.data.songs;else if(t.songs&&Array.isArray(t.songs))e=t.songs;else throw console.error("Unexpected response format:",t),new Error("Invalid response format from server");return e.filter(o=>o.song_id&&o.title).map(o=>({id:o.song_id,title:o.title||"Unknown Title",artist:o.artists&&o.artists.length>0?o.artists[0].name:"Unknown Artist"}))},staleTime:5*60*1e3}),L=P(()=>{if(!a.value)return[];if(!p.value)return a.value;const t=p.value.toLowerCase();return a.value.filter(e=>e.title.toLowerCase().includes(t)||e.artist.toLowerCase().includes(t))}),$=P(()=>!a.value||!u.value||u.value.length===0?[]:a.value.filter(t=>u.value.includes(t.id))),V=P(()=>!!(d.value&&d.value.trim()&&u.value&&u.value.length>0&&_.userId&&!l.value)),j=P(()=>r.value||l.value),q=async t=>{const e=t.target.files[0];if(e){if(!e.type.startsWith("image/")){c.value="Please select a valid image file";return}if(e.size>5*1024*1024){c.value="Image file must be under 5MB";return}y.value=e,c.value=null,await R(e)}},R=async t=>{try{r.value=!0,c.value=null;const e=URL.createObjectURL(t);h.value=e,console.log("Cover file prepared for upload:",t.name)}catch(e){console.error("Cover preparation failed:",e),c.value=`Cover preparation failed: ${e.message}`}finally{r.value=!1}},Q=t=>{u.value&&(u.value=u.value.filter(e=>e!==t))},z=()=>{d.value="",u.value=[],y.value=null,h.value=null,c.value=null,p.value="",r.value=!1,l.value=!1},{mutate:O}=W({mutationFn:async t=>{console.log("Creating playlist with payload:",t);const e=await N.createPlaylist(t);if(e.status!=="success")throw new Error(e.message||"Failed to create playlist");return e.data},onSuccess:t=>{console.log("Playlist created successfully:",t),f.invalidateQueries(["playlists"]),k("create",t),z()},onError:t=>{console.error("Playlist creation failed:",t),c.value=t.message||"Failed to create playlist",l.value=!1}}),Y=async()=>{try{if(c.value=null,!d.value||!d.value.trim()){c.value="Please enter a playlist name";return}if(!u.value||u.value.length===0){c.value="Please select at least one song";return}if(!_.userId){c.value="User not authenticated. Please login again.";return}l.value=!0;const t=u.value,e=new FormData;e.append("name",d.value.trim()),e.append("user_id",_.userId.toString()),e.append("is_public","true"),e.append("is_system","false"),t.forEach(o=>{e.append("song_ids[]",o)}),y.value&&e.append("cover",y.value),console.log("Creating playlist with FormData"),console.log("Selected song IDs:",t),console.log("FormData contents:");for(let[o,F]of e.entries())console.log(o,F);O(e)}catch(t){console.error("Error in handleCreatePlaylist:",t),c.value=t.message||"An unexpected error occurred",l.value=!1}};return(t,e)=>(n(),i("div",le,[s("div",te,[e[8]||(e[8]=s("h2",null,"Create New Playlist",-1)),U(s("input",{"onUpdate:modelValue":e[0]||(e[0]=o=>d.value=o),placeholder:"Enter playlist name",class:"modal-input"},null,512),[[M,d.value]]),s("div",ae,[e[4]||(e[4]=s("label",{for:"cover-upload",class:"cover-label"},"Upload Cover Image (Optional)",-1)),s("input",{id:"cover-upload",type:"file",accept:"image/*",onChange:q,class:"modal-input"},null,32),y.value?(n(),i("p",ne,g(y.value.name),1)):m("",!0),h.value?(n(),i("p",oe,"✓ Cover uploaded successfully")):m("",!0)]),s("div",ie,[e[7]||(e[7]=s("h3",null,"Select Songs",-1)),C(a)&&C(a).length?(n(),i("p",re,g(C(a).length)+" songs available",1)):(n(),i("p",ue,"No songs available")),s("div",ce,[U(s("input",{"onUpdate:modelValue":e[1]||(e[1]=o=>p.value=o),placeholder:"Search songs...",class:"modal-input"},null,512),[[M,p.value]])]),s("div",de,[C(b)?(n(),i("div",ve,e[5]||(e[5]=[s("div",{class:"spinner"},null,-1),s("span",null,"Loading songs...",-1)]))):C(w)?(n(),i("div",ge,[s("span",null,g(C(w).message||"Failed to load songs. Please try again."),1)])):!L.value||L.value.length===0?(n(),i("div",ye,e[6]||(e[6]=[s("span",null,"No songs found",-1)]))):(n(),i("div",pe,[(n(!0),i(S,null,A(L.value,o=>(n(),i("label",{key:o.id,class:"song-item"},[U(s("input",{type:"checkbox","onUpdate:modelValue":e[2]||(e[2]=F=>u.value=F),value:o.id},null,8,me),[[H,u.value]]),s("span",null,g(o.title)+" - "+g(o.artist),1)]))),128))]))]),$.value&&$.value.length>0?(n(),i("div",fe,[s("h4",null,"Selected Songs ("+g($.value.length)+")",1),s("div",_e,[(n(!0),i(S,null,A($.value,o=>(n(),i("div",{key:o.id,class:"selected-item"},[s("span",null,g(o.title)+" - "+g(o.artist),1),s("button",{type:"button",onClick:F=>Q(o.id),class:"remove-btn"}," × ",8,he)]))),128))])])):m("",!0)]),c.value?(n(),i("div",Pe,[s("span",null,g(c.value),1)])):m("",!0),s("div",Ce,[s("button",{onClick:Y,class:"modal-save-btn",disabled:!V.value},g(j.value?"Creating...":"Create Playlist"),9,ke),s("button",{onClick:e[3]||(e[3]=o=>t.$emit("close")),class:"modal-cancel-btn"}," Cancel ")])])]))}},we=D(be,[["__scopeId","data-v-6a51123f"]]),Se={class:"playlist-library"},Ae={class:"library-header mt-4"},$e={key:1,class:"loading-state"},Fe={key:2,class:"error-state"},Ee={key:3,class:"playlist-content"},Ie={key:0,class:"playlist-section"},Le={class:"playlist-grid"},Ue={key:1,class:"playlist-section"},xe={class:"playlist-grid"},Ne={key:2,class:"playlist-section"},Me={class:"playlist-grid"},De={key:3,class:"no-playlists"},Be="/uploads/img/default-playlist.png",Te={__name:"PlaylistLibrary",setup(T){const{playSong:I}=B(),k=v(!0),f=v(null),_=v(!1),d=v([]),p=P(()=>d.value.filter(r=>r.is_top)),u=P(()=>d.value.filter(r=>!r.is_system&&!r.is_top)),y=P(()=>d.value.filter(r=>r.is_system&&!r.is_top)),c=async()=>{try{k.value=!0,f.value=null;const r=await N.getAllPlaylists();if(r.status!=="success"||!Array.isArray(r.data))throw new Error("Expected an array of playlists in response.data");d.value=r.data.map(l=>{let a=0;return"song_count"in l?a=l.song_count:Array.isArray(l.songs)?a=l.songs.length:"songs_count"in l&&(a=l.songs_count),{...l,id:l.playlist_id||l.id,song_count:a,image:l.image_url||Be}})}catch(r){f.value="Failed to load playlists. Please try again.",console.error("Error fetching playlists:",r)}finally{k.value=!1}},h=async r=>{try{const l=await N.getPlaylistDetails(r),b=(l.data||l).songs||[];b.length?await I(b[0],b.map(w=>({...w,audio_url:w.audio_url||""}))):f.value="No songs available in this playlist."}catch(l){f.value="Failed to play playlist.",console.error("Error playing playlist:",l)}};return X(()=>{c()}),(r,l)=>(n(),i("div",Se,[l[10]||(l[10]=s("div",{class:"banner"},[s("img",{src:se,alt:"Playlist Banner",class:"banner-img"}),s("div",{class:"banner-overlay"},[s("h1",null,"Explore Your Favorite Playlists"),s("p",null,"Listen, discover, and enjoy hand-curated music collections.")])],-1)),s("div",Ae,[l[3]||(l[3]=s("h1",{class:"library-title"},[s("i",{class:"fas fa-music"}),Z(" Playlists")],-1)),s("button",{class:"create-btn",onClick:l[0]||(l[0]=a=>_.value=!0)},l[2]||(l[2]=[s("i",{class:"fas fa-plus"},null,-1),s("span",null,"New Playlist",-1)]))]),_.value?(n(),E(we,{key:0,onClose:l[1]||(l[1]=a=>_.value=!1),onCreate:r.handlePlaylistCreation},null,8,["onCreate"])):m("",!0),k.value?(n(),i("div",$e,l[4]||(l[4]=[s("div",{class:"spinner"},null,-1),s("p",null,"Loading playlists...",-1)]))):f.value?(n(),i("div",Fe,[l[5]||(l[5]=s("i",{class:"fas fa-exclamation-triangle"},null,-1)),s("p",null,g(f.value),1),s("button",{onClick:c,class:"retry-btn"},"Try Again")])):(n(),i("div",Ee,[p.value.length?(n(),i("section",Ie,[l[6]||(l[6]=s("h2",{class:"section-title"},"Top Playlists",-1)),s("div",Le,[(n(!0),i(S,null,A(p.value,a=>(n(),E(x,{key:a.id,id:a.id,name:a.name,image:a.image,"song-count":a.song_count,onPlay:h},null,8,["id","name","image","song-count"]))),128))])])):m("",!0),u.value.length?(n(),i("section",Ue,[l[7]||(l[7]=s("h2",{class:"section-title"},"Your Playlists",-1)),s("div",xe,[(n(!0),i(S,null,A(u.value,a=>(n(),E(x,{key:a.id,id:a.id,name:a.name,image:a.image,"song-count":a.song_count,onPlay:h},null,8,["id","name","image","song-count"]))),128))])])):m("",!0),y.value.length?(n(),i("section",Ne,[l[8]||(l[8]=s("h2",{class:"section-title"},"Suggested Playlists",-1)),s("div",Me,[(n(!0),i(S,null,A(y.value,a=>(n(),E(x,{key:a.id,id:a.id,name:a.name,image:a.image,"song-count":a.song_count,onPlay:h},null,8,["id","name","image","song-count"]))),128))])])):m("",!0),!u.value.length&&!y.value.length&&!p.value.length?(n(),i("div",De,l[9]||(l[9]=[s("p",null,"No playlists available. Create one or check back later!",-1)]))):m("",!0)]))]))}},Qe=D(Te,[["__scopeId","data-v-6e2102e1"]]);export{Qe as default};
