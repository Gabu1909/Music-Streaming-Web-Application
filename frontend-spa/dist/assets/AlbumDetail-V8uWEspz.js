import{_ as B,h as C,g as T,x as b,A as U,k as q,B as E,c as n,b as e,a as t,t as L,m as R,d as V,l as g,o,P as M}from"./index-BH3AGQtF.js";import{a as f}from"./album.service-aiTHCnAB.js";import{_ as N}from"./TrackList-BA2PFreG.js";import{A as $}from"./AlbumCard-BOcrsBrV.js";const K={class:"album-detail"},j={key:0,class:"loading"},I={key:1,class:"error"},Q={key:2,class:"album-container"},z={class:"album-header"},G={class:"album-content"},H={__name:"AlbumDetail",setup(J){const r=U(),i=C(null),{currentSong:k,initAudio:v,playSong:u}=T(),{data:l,isLoading:h,error:d,refetch:A}=b({queryKey:["album",r.params.id],queryFn:async()=>(await f.getAlbumDetails(r.params.id)).data?.album||{},onError:a=>{console.error("Failed to fetch album details:",a)}}),{data:c,isLoading:S,error:m,refetch:w}=b({queryKey:["albumSongs",r.params.id],queryFn:async()=>(await f.getAlbumSongs(r.params.id)).data?.songs||[],onError:a=>{console.error("Failed to fetch album songs:",a)}}),P=a=>a?`/${a.replace(/^public\//,"")}`:"/default-album.jpg",p=a=>a.audio_url?`/${a.audio_url.replace(/^public\//,"")}`:"",_=async()=>{const a=(c.value||[]).map(s=>({...s,audioUrl:p(s)}));a.length&&await u(a[0],a)},D=async a=>{const s=(c.value||[]).map(y=>({...y,audioUrl:p(y)}));await u(a,s)},F=a=>{console.log("Track options:",a)},x=async()=>{await Promise.all([A(),w()])};return q(async()=>{await E(),i.value&&v(i.value)}),(a,s)=>(o(),n("div",K,[e(h)||e(S)?(o(),n("div",j,s[0]||(s[0]=[t("div",{class:"spinner"},null,-1),t("p",null,"Loading album details...",-1)]))):e(d)||e(m)?(o(),n("div",I,[t("p",null,L(e(d)?.message||e(m)?.message||"Failed to load album data"),1),t("button",{onClick:x,class:"retry-btn"},"Retry")])):(o(),n("div",Q,[t("div",z,[g($,{title:e(l).title||"Untitled Album",artist:e(l).artist_name||"Unknown Artist",cover_url:P(e(l).cover_url),songData:e(l).songs,onClick:_,onPlay:_},null,8,["title","artist","cover_url","songData"])]),t("div",G,[s[1]||(s[1]=t("h2",null,"Tracks",-1)),g(N,{tracks:e(c)||[],onMore:F,onPlay:D},null,8,["tracks"])]),t("audio",{ref_key:"audioRef",ref:i,preload:"metadata"},null,512),e(k)?(o(),R(M,{key:0})):V("",!0)]))]))}},Z=B(H,[["__scopeId","data-v-1085f7f4"]]);export{Z as default};
