import{E as _}from"./EntityTable-BSKhrtxt.js";import{F as y,B as w}from"./FormFields-B3pZe_m_.js";import{a as h}from"./album.service-aiTHCnAB.js";import{_ as p,m as C,p as A,D as f,o as c,l as u,c as g,d as v,a,f as m,t as n,F,q as M,N as D}from"./index-BH3AGQtF.js";const V={name:"AlbumModal",components:{BaseModal:w,FormFields:y},props:{show:{type:Boolean,default:!1},album:{type:Object,default:()=>({})},mode:{type:String,default:"add",validator:e=>["add","edit"].includes(e)}},emits:["saved","cancel"],data(){return{isSaving:!1,selectedCoverFile:null,selectedSongFiles:[],form:{id:null,title:"",artist:"",release_date:""},showDebug:!0}},computed:{isFormValid(){const e=!!(this.form.title&&this.form.title.trim().length>0),t=!!(this.form.artist&&this.form.artist.toString().trim().length>0);return e&&t}},watch:{album:{handler(e){this.updateFormData(e)},immediate:!0,deep:!0},show(e){e?(this.updateFormData(this.album),this.selectedCoverFile=null,this.selectedSongFiles=[]):(this.selectedCoverFile=null,this.selectedSongFiles=[],this.isSaving=!1)}},methods:{updateFormData(e){const t=e||{};this.form={id:t.album_id||t.id||null,title:String(t.title||"").trim(),artist:t.artist_name||t.artist||"",release_date:t.release_date||""},console.log("Album form data updated:",{...this.form})},handleCoverSelected(e){this.selectedCoverFile=e,console.log("Cover selected:",e.name,this.formatFileSize(e.size))},handleCoverRemoved(){this.selectedCoverFile=null,console.log("Cover removed")},handleSongsSelected(e){this.selectedSongFiles=Array.from(e),console.log("Songs selected:",this.selectedSongFiles.map(t=>`${t.name} (${this.formatFileSize(t.size)})`))},handleSongsRemoved(){this.selectedSongFiles=[],console.log("Songs removed")},formatFileSize(e){if(!e||e===0)return"0 Bytes";const t=1024,l=["Bytes","KB","MB","GB"],i=Math.floor(Math.log(e)/Math.log(t));return parseFloat((e/Math.pow(t,i)).toFixed(2))+" "+l[i]},getFileName(e){if(!e)return"Unknown";const t=String(e).split("/");return t[t.length-1]||"Unknown"},async saveAlbum(){if(!this.isFormValid){alert("Please fill in all required fields.");return}this.isSaving=!0;try{const e=new FormData,t=this.form.title.trim(),l=this.form.artist.toString().trim();if(!t)throw new Error("Album title is required");if(!l)throw new Error("Artist is required");e.append("title",t),e.append("artist",l),this.form.release_date&&e.append("release_date",this.form.release_date),this.selectedCoverFile&&e.append("cover",this.selectedCoverFile),this.selectedSongFiles.forEach((o,s)=>{e.append("audio_files",o),console.log(`Song file ${s+1} attached: ${o.name}`)}),this.mode==="edit"&&this.form.id&&e.append("album_id",this.form.id),console.log("FormData entries:");for(let[o,s]of e.entries())console.log(`  ${o}: ${s instanceof File?`File: ${s.name}`:s}`);let i;this.mode==="edit"&&this.form.id?i=await h.updateAlbum(this.form.id,e):i=await h.createAlbum(e),console.log("Album saved:",i),this.$emit("saved",i)}catch(e){console.error("Save album failed:",e),alert(`Failed to save album: ${e.message}`)}finally{this.isSaving=!1}}}},k={key:0,class:"current-file-info"},x={class:"field-note"},E={key:1,class:"songs-info"},B={class:"field-note"},T={key:2,class:"debug-info"};function N(e,t,l,i,o,s){const d=f("FormFields"),b=f("BaseModal");return c(),C(b,{show:l.show,mode:l.mode,title:"Album","is-form-valid":s.isFormValid,"is-saving":o.isSaving,onSave:s.saveAlbum,onCancel:t[3]||(t[3]=r=>e.$emit("cancel"))},{"form-content":A(()=>[u(d,{type:"row"},{default:A(()=>[u(d,{type:"text",label:"Title",modelValue:o.form.title,"onUpdate:modelValue":t[0]||(t[0]=r=>o.form.title=r),placeholder:"Enter album title",required:""},null,8,["modelValue"]),u(d,{type:"text",label:"Artist",modelValue:o.form.artist,"onUpdate:modelValue":t[1]||(t[1]=r=>o.form.artist=r),placeholder:"Enter artist name (not ID)",required:"",note:"Enter the artist name (e.g., 'Sơn Tùng M-TP'), not the ID number"},null,8,["modelValue"])]),_:1}),u(d,{type:"date",label:"Release Date",modelValue:o.form.release_date,"onUpdate:modelValue":t[2]||(t[2]=r=>o.form.release_date=r),note:"Optional: When was this album released?"},null,8,["modelValue"]),u(d,{type:"file",label:"Cover Image",accept:"image/*","max-size":10*1024*1024,note:"Cover image will be stored as binary data (max 10MB)",onFileSelected:s.handleCoverSelected,onFileRemoved:s.handleCoverRemoved},null,8,["onFileSelected","onFileRemoved"]),u(d,{type:"file",label:"Songs",accept:"audio/*",multiple:"",note:"Select one or more audio files to add as songs to this album (optional)",onFileSelected:s.handleSongsSelected,onFileRemoved:s.handleSongsRemoved},null,8,["onFileSelected","onFileRemoved"]),l.mode==="edit"&&l.album.cover_url&&!o.selectedCoverFile?(c(),g("div",k,[a("div",x,[t[4]||(t[4]=a("strong",null,"Current cover:",-1)),m(" "+n(s.getFileName(l.album.cover_url)),1)])])):v("",!0),o.selectedSongFiles.length?(c(),g("div",E,[a("div",B,[t[5]||(t[5]=a("strong",null,"Selected songs:",-1)),a("ul",null,[(c(!0),g(F,null,M(o.selectedSongFiles,(r,S)=>(c(),g("li",{key:S},n(r.name)+" ("+n(s.formatFileSize(r.size))+") ",1))),128))])])])):v("",!0),o.showDebug?(c(),g("div",T,[a("p",null,[t[6]||(t[6]=a("strong",null,"Form Valid:",-1)),m(" "+n(s.isFormValid),1)]),a("p",null,[t[7]||(t[7]=a("strong",null,"Has Title:",-1)),m(" "+n(!!o.form.title.trim()),1)]),a("p",null,[t[8]||(t[8]=a("strong",null,"Has Artist:",-1)),m(" "+n(!!o.form.artist.toString().trim()),1)]),a("p",null,[t[9]||(t[9]=a("strong",null,"Artist:",-1)),m(" "+n(o.form.artist),1)]),a("p",null,[t[10]||(t[10]=a("strong",null,"Mode:",-1)),m(" "+n(l.mode),1)]),a("p",null,[t[11]||(t[11]=a("strong",null,"Has Cover:",-1)),m(" "+n(!!o.selectedCoverFile),1)]),a("p",null,[t[12]||(t[12]=a("strong",null,"Selected Songs:",-1)),m(" "+n(o.selectedSongFiles.length),1)])])):v("",!0)]),_:1},8,["show","mode","is-form-valid","is-saving","onSave"])}const R=p(V,[["render",N]]),z={name:"Albums",components:{EntityTable:_,AlbumModal:R},data(){return{albums:[],showModal:!1,selectedAlbum:null,modalMode:"add",tableConfig:{tableTitle:"Album Collection",entityName:"albums",searchPlaceholder:"Search albums by title...",addButtonText:"Add Album",emptyMessage:"No albums found. Create your first album to get started.",itemsPerPage:15,searchableColumns:["title","artist_name"],columns:[{key:"cover_url",label:"Cover",type:"avatar",sortable:!1,maxLength:0},{key:"album_id",label:"ID",type:"text",sortable:!0,maxLength:10},{key:"title",label:"Album Title",type:"text",sortable:!0,maxLength:35},{key:"artist_name",label:"Artist",type:"text",sortable:!0,maxLength:20},{key:"release_date",label:"Release Date",type:"date",sortable:!0,maxLength:0},{key:"actions",label:"Actions",type:"actions",sortable:!1,maxLength:0}]}}},methods:{async fetchAlbums(){try{const e=await h.getAllAlbums();let t=[];e?.status==="success"&&e.data?t=Array.isArray(e.data)?e.data:e.data.albums||[]:Array.isArray(e)&&(t=e),this.albums=t.map(l=>({album_id:l.album_id||l.id,title:l.title||"Unknown Album",artist_id:l.artist_id,artist_name:l.artist_name||l.artist||"Unknown Artist",cover_url:l.cover_url?`/public/uploads/images${l.cover_url}`:null,release_date:l.release_date,song_count:l.song_count||0}))}catch(e){console.error("Error fetching albums:",e),alert(`Failed to load albums: ${e.message}`),this.albums=[]}},async onAlbumSaved(e){this.closeModal();const t=this.modalMode==="edit"?"updated":"added";alert(`Album has been ${t} successfully. ${e?.data?.song_count?`${e.data.song_count} song(s) added.`:""}`),await this.fetchAlbums()},openAddAlbum(){console.log("Opening add album modal"),this.selectedAlbum={},this.modalMode="add",this.showModal=!0},openEditAlbum(e){console.log("Opening edit album modal for:",e.title),this.selectedAlbum=e?{...e}:{},this.modalMode="edit",this.showModal=!0},viewAlbum(e){if(!e)return;console.log("Viewing album details:",e.title);const t=e.release_date?new Date(e.release_date).toLocaleDateString():"Unknown",l=`Album Details:

      ID: ${e.album_id||"N/A"}
      Title: ${e.title||"N/A"}
      Artist: ${e.artist_name||"N/A"}
      Artist ID: ${e.artist_id||"N/A"}
      Release Date: ${t}
      Songs Count: ${e.song_count||0}
      Cover: ${e.cover_url?"Yes":"No"}`;alert(l)},async deleteAlbum(e){if(!e||!e.album_id){console.error("Invalid album object for deletion");return}const t=`Are you sure you want to delete album "${e.title}"?

This action cannot be undone.`;if(confirm(t))try{console.log("Deleting album:",e.title),await h.delete(e.album_id),this.albums=this.albums.filter(l=>l.album_id!==e.album_id),console.log("Album deleted successfully"),alert(`Album "${e.title}" has been deleted successfully.`),await this.fetchAlbums()}catch(l){console.error("Error deleting album:",l);const i=l.response?.data?.message||l.message;alert(`Failed to delete album: ${i}`),await this.fetchAlbums()}},closeModal(){console.log("Closing album modal"),this.showModal=!1,this.selectedAlbum=null,this.modalMode="add"}},mounted(){this.fetchAlbums()}};function L(e,t,l,i,o,s){const d=f("EntityTable"),b=f("AlbumModal");return c(),g(F,null,[u(d,D(o.tableConfig,{rows:o.albums,onAdd:s.openAddAlbum,onEdit:s.openEditAlbum,onDelete:s.deleteAlbum,onView:s.viewAlbum}),null,16,["rows","onAdd","onEdit","onDelete","onView"]),u(b,{show:o.showModal,album:o.selectedAlbum||{},mode:o.modalMode,onSaved:s.onAlbumSaved,onCancel:s.closeModal},null,8,["show","album","mode","onSaved","onCancel"])],64)}const O=p(z,[["render",L]]);export{O as default};
