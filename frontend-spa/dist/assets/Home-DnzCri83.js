import{_ as $,c as o,o as r,a,r as M,t as y,g as R,h as u,j as q,k as U,l as b,b as S,f as K,m as D,d as k,p as E,F as T,q as N,n as O}from"./index-DTmEoMLP.js";/* empty css                                                                 *//* empty css                                                                     */import{A as H}from"./AlbumCard-QnN6sERx.js";import{S as L}from"./song.service-C1QnVOq0.js";const W="/assets/banner-BUcSJjlm.jpg",Y={},G={class:"banner rounded mb-4",style:{height:"200px",background:"url('../../uploads/img/banner.jpg') center/cover"}};function J(d,s){return r(),o("div",G)}const Q=$(Y,[["render",J]]),X={name:"SectionContainer",props:{title:String}},Z={class:"section-container mb-5"},tt={class:"section-title mb-4"};function et(d,s,n,_,g,m){return r(),o("section",Z,[a("h2",tt,y(n.title),1),M(d.$slots,"default",{},void 0)])}const I=$(X,[["render",et],["__scopeId","data-v-039e23ad"]]),at={props:{title:{type:String,required:!0},artist:{type:String,required:!0},image_url:{type:String,required:!0},duration:{type:String,default:"0:00"},songData:Object},methods:{playSong(){this.$emit("play",{title:this.title,artist:this.artist,song:this.songData})},getSongCover(d){return d?`${d.replace(/^public\//,"")}`:"/default-song.jpg"}}},it={class:"song-image"},st=["src","alt"],rt={class:"song-info"},nt={class:"song-title"},lt={class:"song-artist"},ot={class:"song-meta"},ct={class:"song-duration"};function ut(d,s,n,_,g,m){return r(),o("div",{class:"song-card",onClick:s[0]||(s[0]=(...p)=>m.playSong&&m.playSong(...p))},[a("div",it,[a("img",{src:m.getSongCover(n.image_url),alt:n.title},null,8,st),s[1]||(s[1]=a("button",{class:"play-button"},[a("i",{class:"bi bi-play-fill"})],-1))]),a("div",rt,[a("h4",nt,y(n.title),1),a("p",lt,y(n.artist),1),a("div",ot,[a("span",ct,y(n.duration),1),s[2]||(s[2]=a("button",{class:"song-action"},[a("i",{class:"bi bi-heart"})],-1))])])])}const dt=$(at,[["render",ut],["__scopeId","data-v-272be16b"]]),mt={class:"home-view"},vt={key:0,class:"text-center py-5"},_t={key:1,class:"alert alert-danger mx-3",role:"alert"},gt={key:2},pt={class:"row"},ft={class:"release-tabs mb-4"},yt={class:"row"},ht={class:"row"},bt={key:3,class:"text-center py-5"},St={__name:"Home",setup(d){const s=R(),n=u([]),_=u([]),g=u([]),m=u([]),p=u([]),C=u(!0),P=u(null),v=u("all"),w=q(()=>s.state.currentSong?.id),z=async()=>{try{C.value=!0;const t=await L.getSongs();n.value=t.data?.songs||t.songs||[],console.log("Fetched songs:",n.value),F()}catch(t){console.error("Error fetching songs:",t),P.value="Không thể tải dữ liệu bài hát"}finally{C.value=!1}},F=()=>{if(!Array.isArray(n.value)||!n.value.length)return;const t=[...n.value].sort(()=>Math.random()-.5);_.value=t.slice(0,8);const i=[...n.value].sort((l,c)=>{const B=new Date(l.createdAt||l.created_at||l.updated_at||0);return new Date(c.createdAt||c.created_at||c.updated_at||0)-B});let e=i;v.value==="vietnam"?e=i.filter(l=>h(l.title)||h(f(l))):v.value==="international"&&(e=i.filter(l=>!h(l.title)&&!h(f(l)))),g.value=e.slice(0,6),m.value=t.slice(8,14),p.value=t.slice(14,20)},h=t=>t?/[àáạảãâầấậẩẫăằắặẳẵèéẹẻẽêềếệểễìíịỉĩòóọỏõôồốộổỗơờớợởỡùúụủũưừứựửữỳýỵỷỹđ]/i.test(t):!1,x=t=>{v.value=t,F()},V=t=>{if(!t)return"0:00";if(typeof t=="string"&&t.includes(":"))return t;const i=Math.floor(t/60),e=Math.floor(t%60);return`${i}:${e.toString().padStart(2,"0")}`},A=t=>{if(!t)return null;if(t.image_url)return t.image_url;if(t.thumbnail)return t.thumbnail;if(t.album&&t.album.cover_url)return t.album.cover_url;if(t.artist){if(t.artist.avatar_url)return t.artist.avatar_url;if(t.artist.image_url)return t.artist.image_url}return"/uploads/img/default-cover.jpg"},f=t=>Array.isArray(t.artists)&&t.artists.length>0?t.artists.map(i=>i.name||"Unknown").join(", "):typeof t.artist=="string"?t.artist:t.artist&&t.artist.name?t.artist.name:"Unknown Artist",j=async t=>{try{const i=t.song_id||t.id;if(s.currentTrack?.id===i)return s.togglePlay();const e=await s.normalizeSongData({...t,artist:typeof t.artist=="string"?t.artist:t.artists?.map(c=>c.name).join(", ")}),l=(await Promise.all(n.value.map(c=>s.normalizeSongData({...c,artist:typeof c.artist=="string"?c.artist:c.artists?.map(B=>B.name).join(", ")})))).filter(Boolean);await s.playSong(e,l)}catch(i){console.error("Error playing song:",i)}};return U(()=>{z()}),(t,i)=>(r(),o("div",mt,[b(Q,{title:"Chào mừng trở lại",subtitle:"Hàng ngàn bài hát đang chờ bạn khám phá",background:S(W),gradient:"linear-gradient(to right, #6a11cb, #2575fc)"},null,8,["background"]),C.value?(r(),o("div",vt,i[3]||(i[3]=[a("div",{class:"spinner-border text-primary",role:"status"},[a("span",{class:"visually-hidden"},"Đang tải...")],-1),a("p",{class:"mt-2"},"Đang tải dữ liệu...",-1)]))):P.value?(r(),o("div",_t,[K(y(P.value)+" ",1),a("button",{onClick:z,class:"btn btn-outline-danger btn-sm ms-2"}," Thử lại ")])):(r(),o("div",gt,[_.value.length>0?(r(),D(I,{key:0,title:"TOP SONGS OF WEEK"},{default:E(()=>[a("div",pt,[(r(!0),o(T,null,N(_.value,e=>(r(),o("div",{key:e.id||e._id,class:"col-lg-3 col-md-4 col-6 mb-4"},[b(dt,{title:e.title||e.name,artist:f(e),image_url:A(e),duration:V(e.duration),"song-data":e,"is-playing":w.value===(e.id||e._id)&&S(s).state.isPlaying,onPlay:l=>j(e)},null,8,["title","artist","image_url","duration","song-data","is-playing","onPlay"])]))),128))])]),_:1})):k("",!0),g.value.length>0?(r(),D(I,{key:1,title:"NEW RELEASE"},{default:E(()=>[a("div",ft,[a("button",{class:O(["tab",{active:v.value==="all"}]),onClick:i[0]||(i[0]=e=>x("all"))}," Tất Cả ",2),a("button",{class:O(["tab",{active:v.value==="vietnam"}]),onClick:i[1]||(i[1]=e=>x("vietnam"))}," Việt Nam ",2),a("button",{class:O(["tab",{active:v.value==="international"}]),onClick:i[2]||(i[2]=e=>x("international"))}," Quốc Tế ",2)]),a("div",yt,[(r(!0),o(T,null,N(g.value,(e,l)=>(r(),o("div",{key:e.id||e._id,class:"col-md-2 col-6 mb-3"},[b(H,{title:e.title||e.name,artist:f(e),cover_url:A(e),badge:l<3?"Mới":"Hot","song-data":e,"is-playing":w.value===(e.id||e._id)&&S(s).state.isPlaying,onPlay:c=>j(e)},null,8,["title","artist","cover_url","badge","song-data","is-playing","onPlay"])]))),128))])]),_:1})):k("",!0),p.value.length>0?(r(),D(I,{key:2,title:"FOR YOU FOR TODAY"},{default:E(()=>[a("div",ht,[(r(!0),o(T,null,N(p.value,e=>(r(),o("div",{key:e.id||e._id,class:"col-md-2 col-6 mb-3"},[b(H,{title:e.title||e.name,artist:f(e),cover_url:A(e),"song-data":e,"is-playing":w.value===(e.id||e._id)&&S(s).state.isPlaying,onPlay:l=>j(e)},null,8,["title","artist","cover_url","song-data","is-playing","onPlay"])]))),128))])]),_:1})):k("",!0),n.value.length===0?(r(),o("div",bt,i[4]||(i[4]=[a("i",{class:"bi bi-music-note-list",style:{"font-size":"4rem",color:"#ccc"}},null,-1),a("h4",{class:"mt-3 text-muted"},"Chưa có bài hát nào",-1),a("p",{class:"text-muted"},"Hãy thêm một số bài hát vào thư viện của bạn",-1)]))):k("",!0)]))]))}},At=$(St,[["__scopeId","data-v-82f45520"]]);export{At as default};
