import{_ as Q,g as q,s as S,h as U,x as V,j as f,c as o,a as s,e as j,v as B,b as n,t as v,d as L,F as y,q as _,y as R,z,o as a,l as h}from"./index-DTmEoMLP.js";import{A as k}from"./AlbumCard-QnN6sERx.js";import{a as N}from"./album.service-BjdX50kz.js";const E={class:"album-library-view container-fluid"},I={class:"library-header row align-items-center mb-4"},M={class:"col-md-6"},O={class:"search-controls d-flex"},W={key:0,class:"row justify-content-center py-5"},Z={key:1,class:"row justify-content-center py-5"},H={class:"col-12 col-md-8 text-center"},K={class:"error-message"},G={class:"my-2"},J={key:2},X={key:0,class:"mb-5"},Y={class:"row row-cols-2 row-cols-sm-3 row-cols-md-4 row-cols-lg-5 row-cols-xl-6 g-3"},tt={key:1,class:"mb-5"},et={class:"row row-cols-2 row-cols-sm-3 row-cols-md-4 row-cols-lg-5 row-cols-xl-6 g-3"},st={key:2},lt={class:"row align-items-center mb-3"},ot={class:"col-md-6 d-flex justify-content-md-end align-items-center"},at={class:"album-count me-3"},rt=["value"],nt={key:0,class:"row row-cols-2 row-cols-sm-3 row-cols-md-4 row-cols-lg-5 row-cols-xl-6 g-3"},it={key:1,class:"row justify-content-center py-5"},ct={key:3,class:"row justify-content-center py-5"},ut={__name:"AlbumLibrary",setup(dt){const P=z(),b=q(),A=S(),c=U(""),p=U("recent"),T=l=>{if(!l)return"/default-artist.jpg";const t=l.replace(/^\/?public/,"");return t.startsWith("/")?t:"/"+t},$=[{value:"recent",label:"Recently Added"},{value:"title-asc",label:"Title (A-Z)"},{value:"title-desc",label:"Title (Z-A)"}],{data:u,isLoading:F,error:C,refetch:d}=V({queryKey:["albums"],queryFn:async()=>(await N.getAllAlbums()).data.albums.map(t=>({...t,artist_name:t.artist_name||"Unknown Artist"}))||[],onError:l=>{console.error("Failed to fetch albums:",l)}}),m=f(()=>{let l=[...u.value||[]];if(c.value){const t=c.value.toLowerCase();l=l.filter(e=>e.title.toLowerCase().includes(t)||e.artist_name&&e.artist_name.toLowerCase().includes(t))}switch(p.value){case"title-asc":return l.sort((t,e)=>t.title.localeCompare(e.title));case"title-desc":return l.sort((t,e)=>e.title.localeCompare(t.title));case"recent":default:return l.sort((t,e)=>new Date(e.created_at||0)-new Date(t.created_at||0))}}),x=f(()=>[...u.value||[]].sort((l,t)=>new Date(t.created_at||0)-new Date(l.created_at||0)).slice(0,6)),D=f(()=>[...u.value||[]].sort((l,t)=>(t.play_count||0)-(l.play_count||0)).slice(0,6));async function w(l){try{const t=await N.getAlbumDetails(l),e=t.songs||[];if(e.length){const r=e.map(i=>({...i,id:i.song_id||i.id,audio_url:i.audio_url||"",artist:i.artist||t.artist_name||"Unknown Artist"}));b.setCurrentTrack(r[0]),b.setQueue(r),b.play()}else console.error("No songs found in album"),A.setQueryData(["albums","error"],"No songs available in this album.")}catch(t){console.error("Failed to play album:",t),A.setQueryData(["albums","error"],"Failed to play album. Please try again.")}}function g(l){P.push(`/albums/${l}`)}return(l,t)=>(a(),o("div",E,[s("div",I,[t[5]||(t[5]=s("div",{class:"col-md-6"},[s("h1",{class:"hero-title"},"Albums Hub"),s("p",{class:"hero-subtitle"},"Where every album tells a story")],-1)),s("div",M,[s("div",O,[j(s("input",{type:"text",placeholder:"Search albums...",class:"search-input","onUpdate:modelValue":t[0]||(t[0]=e=>c.value=e)},null,512),[[B,c.value]]),s("button",{class:"refresh-button btn ms-2",onClick:t[1]||(t[1]=(...e)=>n(d)&&n(d)(...e))},t[4]||(t[4]=[s("i",{class:"fa fa-search"},null,-1)]))])])]),n(F)?(a(),o("div",W,t[6]||(t[6]=[s("div",{class:"col-12 text-center"},[s("div",{class:"loading-spinner"}),s("div",{class:"loading-text"},"Loading albums...")],-1)]))):n(C)?(a(),o("div",Z,[s("div",H,[s("div",K,[t[7]||(t[7]=s("i",{class:"bi bi-exclamation-circle-fill"},null,-1)),s("div",G,v(n(C).message),1),s("button",{class:"retry-button btn",onClick:t[2]||(t[2]=(...e)=>n(d)&&n(d)(...e))},"Try Again")])])])):(a(),o("div",J,[x.value.length?(a(),o("section",X,[t[8]||(t[8]=s("div",{class:"row mb-3"},[s("div",{class:"col"},[s("h2",{class:"section-title"},"New Releases")])],-1)),s("div",Y,[(a(!0),o(y,null,_(x.value,e=>(a(),o("div",{class:"col",key:"new-"+e.album_id},[h(k,{title:e.title,artist:e.artist_name||"Unknown Artist",cover_url:T(e.cover_url),songData:{},onClick:r=>g(e.album_id),onPlay:r=>w(e.album_id)},null,8,["title","artist","cover_url","onClick","onPlay"])]))),128))])])):L("",!0),D.value.length?(a(),o("section",tt,[t[9]||(t[9]=s("div",{class:"row mb-3"},[s("div",{class:"col"},[s("h2",{class:"section-title"},"Top Albums")])],-1)),s("div",et,[(a(!0),o(y,null,_(D.value,e=>(a(),o("div",{class:"col",key:"top-"+e.album_id},[h(k,{title:e.title,artist:e.artist_name||"Unknown Artist",cover_url:e.cover_url,songData:{},play_count:e.play_count,onClick:r=>g(e.album_id),onPlay:r=>w(e.album_id)},null,8,["title","artist","cover_url","play_count","onClick","onPlay"])]))),128))])])):L("",!0),n(u).length?(a(),o("section",st,[s("div",lt,[t[10]||(t[10]=s("div",{class:"col-md-6"},[s("h2",{class:"section-title"},"All Albums")],-1)),s("div",ot,[s("div",at,v(m.value.length)+" "+v(m.value.length===1?"album":"albums"),1),j(s("select",{class:"sort-select form-select","onUpdate:modelValue":t[3]||(t[3]=e=>p.value=e),style:{width:"auto"}},[(a(),o(y,null,_($,e=>s("option",{value:e.value,key:e.value},v(e.label),9,rt)),64))],512),[[R,p.value]])])]),m.value.length?(a(),o("div",nt,[(a(!0),o(y,null,_(m.value,e=>(a(),o("div",{class:"col",key:e.album_id},[h(k,{title:e.title,artist:e.artist_name||"Unknown Artist",cover_url:e.cover_url,songData:{},onClick:r=>g(e.album_id),onPlay:r=>w(e.album_id)},null,8,["title","artist","cover_url","onClick","onPlay"])]))),128))])):(a(),o("div",it,t[11]||(t[11]=[s("div",{class:"col-12 text-center"},[s("div",{class:"no-results-message"},[s("i",{class:"bi bi-search"}),s("h3",null,"No albums found"),s("p",null,"Try adjusting your search or filter criteria")])],-1)])))])):(a(),o("div",ct,t[12]||(t[12]=[s("div",{class:"col-12 col-md-8 text-center"},[s("div",{class:"empty-state"},[s("i",{class:"bi bi-collection"}),s("h3",null,"No albums found"),s("p",null,"It seems you don't have any albums yet."),s("button",{class:"action-button btn"},"Upload Album")])],-1)])))]))]))}},_t=Q(ut,[["__scopeId","data-v-f548fb25"]]);export{_t as default};
