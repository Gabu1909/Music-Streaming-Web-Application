import{_ as M,g as U,h as f,x as T,j as C,E as D,c as r,o,a as e,e as x,d as h,v as I,t as _,b as m,F as E,q as S,G as V,k as j,m as k,f as q}from"./index-BH3AGQtF.js";import{p as $,P as L}from"./PlaylistCard-BjIPS2iP.js";import{S as z}from"./song.service-BEFtWEPn.js";/* empty css                                                                     */const J="/uploads/img/playlist-banner.jpg",O={class:"modal"},R={class:"modal-content"},Y={class:"cover-upload"},G={key:0,class:"cover-preview"},H={class:"song-selection"},K={key:0,class:"song-count"},Q={key:1,class:"song-count"},W={class:"song-search"},X={class:"song-list"},Z={key:0,class:"loading-state"},ee={key:1,class:"error-message"},se={key:2,class:"no-songs"},ae={key:3,class:"song-list-items"},le=["value"],te={key:0,class:"error-message"},oe={class:"modal-actions"},ne=["disabled"],re={__name:"CreatePlaylistModal",emits:["close","create"],setup(B,{emit:A}){const w=A,g=U(),v=f(""),u=f(""),d=f([]),c=f(null),y=f(null),{data:p,isLoading:F,error:P}=T({queryKey:["songs"],queryFn:async()=>{console.log("Fetching songs from /api/songs...");const l=await z.getSongs();console.log("Raw API response:",l);let a=[];if(Array.isArray(l))a=l;else if(l.status==="success"&&Array.isArray(l.data))a=l.data;else if(l.status==="success"&&Array.isArray(l.data.songs))a=l.data.songs;else if(l.songs&&Array.isArray(l.songs))a=l.songs;else throw console.log("Unexpected response type:",typeof l,"Response:",l),new Error("Invalid response format: Expected song data");return a.filter(n=>n.song_id&&n.title).map(n=>({id:n.song_id,title:n.title||"Unknown Title",artist:n.artists&&n.artists.length>0?n.artists[0].name:"Unknown Artist"}))},onError:l=>{console.error("Error fetching songs:",l)}}),i=C(()=>(console.log("Filtering songs, search:",u.value,"total songs:",p.value?.length||0),u.value?(p.value||[]).filter(l=>l.title.toLowerCase().includes(u.value.toLowerCase())||l.artist.toLowerCase().includes(u.value.toLowerCase())):p.value||[])),{mutate:s,isLoading:t}=D({mutationFn:async()=>{if(!v.value?.trim())throw new Error("Please enter a playlist name.");if(d.value.length===0)throw new Error("Please select at least one song.");if(!c.value)throw new Error("Please upload a cover image.");if(!g.userId)throw new Error("No authenticated user found. Please log in.");new FormData().append("file",c.value);const a={name:v.value.trim(),song_ids:d.value,user_id:g.userId.toString(),is_public:!0,is_system:!0,cover_url:coverUrl};if(console.log("Creating playlist with JSON:",a),!d.value.every(N=>typeof N=="number"))throw console.error("Invalid song_ids:",d.value),new Error("Invalid song selection. Please try again.");const n=await $.createPlaylist(a);if(!n.data)throw new Error("Invalid response from server: No data returned.");return n.data},onSuccess:l=>{console.log("Playlist creation successful:",l),w("create",l),v.value="",d.value=[],c.value=null,y.value=null},onError:l=>{let a=l.message;if(l.message.includes("HTTP error"))try{a=JSON.parse(l.message.match(/body: ({.*})/)[1]).message||"Failed to create playlist. Please try again."}catch{a="Failed to create playlist. Invalid server response."}y.value=a,console.error("Error creating playlist:",l)}}),b=l=>{const a=l.target.files[0];a&&a.type.startsWith("image/")&&a.size<5*1024*1024?(c.value=a,y.value=null):(c.value=null,y.value="Please upload a valid image file under 5MB.")};return(l,a)=>(o(),r("div",O,[e("div",R,[a[9]||(a[9]=e("h2",null,"Create New Playlist",-1)),x(e("input",{"onUpdate:modelValue":a[0]||(a[0]=n=>v.value=n),placeholder:"Enter playlist name",class:"modal-input"},null,512),[[I,v.value]]),e("div",Y,[a[5]||(a[5]=e("label",{for:"cover-upload",class:"cover-label"},"Upload Cover Image",-1)),e("input",{id:"cover-upload",type:"file",accept:"image/*",onChange:b,class:"modal-input"},null,32),c.value?(o(),r("p",G,_(c.value.name),1)):h("",!0)]),e("div",H,[a[8]||(a[8]=e("h3",null,"Select Songs",-1)),m(p)?.length?(o(),r("p",K,_(m(p).length)+" songs available",1)):(o(),r("p",Q,"No songs available")),e("div",W,[x(e("input",{"onUpdate:modelValue":a[1]||(a[1]=n=>u.value=n),placeholder:"Search songs...",class:"modal-input"},null,512),[[I,u.value]])]),e("div",X,[m(F)?(o(),r("div",Z,a[6]||(a[6]=[e("div",{class:"spinner"},null,-1),e("span",null,"Loading songs...",-1)]))):m(P)?(o(),r("div",ee,[e("span",null,_(m(P).message||"Failed to load songs. Please try again."),1)])):i.value.length===0?(o(),r("div",se,a[7]||(a[7]=[e("span",null,"No songs found",-1)]))):(o(),r("div",ae,[(o(!0),r(E,null,S(i.value,n=>(o(),r("label",{key:n.id,class:"song-item"},[x(e("input",{type:"checkbox","onUpdate:modelValue":a[2]||(a[2]=N=>d.value=N),value:n.id},null,8,le),[[V,d.value]]),e("span",null,_(n.title)+" - "+_(n.artist),1)]))),128))]))])]),y.value?(o(),r("div",te,[e("span",null,_(y.value),1)])):h("",!0),e("div",oe,[e("button",{onClick:a[3]||(a[3]=(...n)=>m(s)&&m(s)(...n)),class:"modal-save-btn",disabled:m(t)},_(m(t)?"Saving...":"Save"),9,ne),e("button",{onClick:a[4]||(a[4]=n=>l.$emit("close")),class:"modal-cancel-btn"},"Cancel")])])]))}},ie=M(re,[["__scopeId","data-v-50f1ac1b"]]),ue={class:"playlist-library"},de={class:"library-header mt-4"},ce={key:1,class:"loading-state"},ge={key:2,class:"error-state"},ve={key:3,class:"playlist-content"},ye={key:0,class:"playlist-section"},pe={class:"playlist-grid"},me={key:1,class:"playlist-section"},fe={class:"playlist-grid"},_e={key:2,class:"playlist-section"},he={class:"playlist-grid"},Pe={key:3,class:"no-playlists"},we="/uploads/img/default-playlist.png",be={__name:"PlaylistLibrary",setup(B){const{playSong:A}=U(),w=f(!0),g=f(null),v=f(!1),u=f([]),d=C(()=>u.value.filter(i=>i.is_top)),c=C(()=>u.value.filter(i=>!i.is_system&&!i.is_top)),y=C(()=>u.value.filter(i=>i.is_system&&!i.is_top)),p=async()=>{try{w.value=!0,g.value=null;const i=await $.getAllPlaylists();if(i.status!=="success"||!Array.isArray(i.data))throw new Error("Expected an array of playlists in response.data");u.value=i.data.map(s=>{let t=0;return"song_count"in s?t=s.song_count:Array.isArray(s.songs)?t=s.songs.length:"songs_count"in s&&(t=s.songs_count),{...s,id:s.playlist_id||s.id,song_count:t,image:s.image_url||we}}),console.log("Normalized playlist:",u.value)}catch(i){g.value="Failed to load playlists. Please try again.",console.error("Error fetching playlists:",i)}finally{w.value=!1}},F=async i=>{try{await $.createPlaylist(i),v.value=!1,await p()}catch(s){g.value="Failed to create playlist.",console.error("Error creating playlist:",s)}},P=async i=>{try{const s=await $.getPlaylistDetails(i),b=(s.data||s).songs||[];b.length?await A(b[0],b.map(l=>({...l,audio_url:l.audio_url||""}))):g.value="No songs available in this playlist."}catch(s){g.value="Failed to play playlist.",console.error("Error playing playlist:",s)}};return j(()=>{p()}),(i,s)=>(o(),r("div",ue,[s[10]||(s[10]=e("div",{class:"banner"},[e("img",{src:J,alt:"Playlist Banner",class:"banner-img"}),e("div",{class:"banner-overlay"},[e("h1",null,"Explore Your Favorite Playlists"),e("p",null,"Listen, discover, and enjoy hand-curated music collections.")])],-1)),e("div",de,[s[3]||(s[3]=e("h1",{class:"library-title"},[e("i",{class:"fas fa-music"}),q(" Playlists")],-1)),e("button",{class:"create-btn",onClick:s[0]||(s[0]=t=>v.value=!0)},s[2]||(s[2]=[e("i",{class:"fas fa-plus"},null,-1),e("span",null,"New Playlist",-1)]))]),v.value?(o(),k(ie,{key:0,onClose:s[1]||(s[1]=t=>v.value=!1),onCreate:F})):h("",!0),w.value?(o(),r("div",ce,s[4]||(s[4]=[e("div",{class:"spinner"},null,-1),e("p",null,"Loading playlists...",-1)]))):g.value?(o(),r("div",ge,[s[5]||(s[5]=e("i",{class:"fas fa-exclamation-triangle"},null,-1)),e("p",null,_(g.value),1),e("button",{onClick:p,class:"retry-btn"},"Try Again")])):(o(),r("div",ve,[d.value.length?(o(),r("section",ye,[s[6]||(s[6]=e("h2",{class:"section-title"},"Top Playlists",-1)),e("div",pe,[(o(!0),r(E,null,S(d.value,t=>(o(),k(L,{key:t.id,id:t.id,name:t.name,image:t.image,songCount:t.song_count,onPlay:P},null,8,["id","name","image","songCount"]))),128))])])):h("",!0),c.value.length?(o(),r("section",me,[s[7]||(s[7]=e("h2",{class:"section-title"},"Your Playlists",-1)),e("div",fe,[(o(!0),r(E,null,S(c.value,t=>(o(),k(L,{key:t.id,id:t.id,name:t.name,image:t.image,songCount:t.song_count,onPlay:P},null,8,["id","name","image","songCount"]))),128))])])):h("",!0),y.value.length?(o(),r("section",_e,[s[8]||(s[8]=e("h2",{class:"section-title"},"Suggested Playlists",-1)),e("div",he,[(o(!0),r(E,null,S(y.value,t=>(o(),k(L,{key:t.id,id:t.id,name:t.name,image:t.image,"song-count":t.song_count,onPlay:P},null,8,["id","name","image","song-count"]))),128))])])):h("",!0),!c.value.length&&!y.value.length&&!d.value.length?(o(),r("div",Pe,s[9]||(s[9]=[e("p",null,"No playlists available. Create one or check back later!",-1)]))):h("",!0)]))]))}},$e=M(be,[["__scopeId","data-v-cf421a78"]]);export{$e as default};
