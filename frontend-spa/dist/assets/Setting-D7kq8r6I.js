import{_ as S,s as N,u as q,h as d,x as M,M as B,E as T,j as g,c,a as s,b as h,e as _,v as y,z as A,o as v,N as P}from"./index-DTmEoMLP.js";const L={class:"settings-container"},Q={key:0,class:"loading"},R={key:1,class:"error"},V={key:2,class:"settings-form"},j={class:"form-group"},z={class:"form-group"},K={class:"form-group"},G={class:"avatar-container"},H=["src"],J={class:"form-actions"},O=["disabled"],w="uploads/img/default-avatar.jpg",W={__name:"Setting",setup(X){const m=A(),b=N(),{userId:l,showToast:r,validateEmail:E,setUser:U}=q(),i=d(""),o=d(""),u=d(null),f=d(null),{data:t,isLoading:k,isError:Y,refetch:Z}=M({queryKey:["user",l],queryFn:async()=>{if(!l.value)throw new Error("No user ID");const e=await P.getUser();if(e?.status==="success"&&e.data?.user_id)return e.data;if(e?.user_id)return e;throw new Error("Invalid user data")},enabled:!!l.value});B(()=>{t.value&&(i.value=t.value.username||t.value.email||"User",o.value=t.value.email||"",f.value=t.value.avatar_url||w)});const C=e=>{const a=e.target.files[0];if(!a)return;if(!a.type.match("image.*")){r("Please select a valid image file","error");return}if(a.size>2*1024*1024){r("Image must not exceed 2MB","error");return}u.value=a;const n=new FileReader;n.onload=x=>{f.value=x.target.result},n.readAsDataURL(a)},p=T({mutationFn:async e=>{if(!l.value)throw new Error("No user ID");return console.log("Calling updateProfile with userId:",l.value),await P.updateProfile(l.value,e)},onSuccess:async e=>{console.log("Profile update success:",e),e?.status==="success"?(r("ðŸŽ‰ Profile updated successfully!","success"),U(e.data),b.invalidateQueries({queryKey:["user",l.value]}),setTimeout(()=>m.push("/"),1500)):r(e?.message||"Profile update failed","error")},onError:e=>{console.log("Profile update error:",e);let a="Profile update failed";e.message.includes("Failed to fetch")?a="Network error: Unable to reach the server":e.message.includes("No token found")?a="Please log in again":a=e.message||a,r(a,"error")}}),I=()=>{if(console.log("Token:",localStorage.getItem("token")),console.log("UserId:",l.value),!l.value){r("User ID not found","error");return}if(!i.value||!o.value){r("Please fill in all required fields","error");return}if(!E(o.value)){r("Invalid email format","error");return}const e=new FormData;e.append("username",i.value),e.append("email",o.value),u.value&&e.append("avatar_url",u.value),p.mutate(e)},F=()=>{m.push("/")},D=g(()=>t.value?i.value!==(t.value.username||t.value.email||"User")||o.value!==(t.value.email||"")||u.value!==null:!1);return g(()=>p.isPending),(e,a)=>(v(),c("div",L,[a[5]||(a[5]=s("h1",{class:"settings-title"},"Profile Settings",-1)),h(k)?(v(),c("div",Q,"Loading profile...")):h(t)?(v(),c("div",V,[s("div",j,[a[2]||(a[2]=s("label",{for:"username"},"Username",-1)),_(s("input",{id:"username","onUpdate:modelValue":a[0]||(a[0]=n=>i.value=n),type:"text",placeholder:"Enter your username",class:"form-input"},null,512),[[y,i.value]])]),s("div",z,[a[3]||(a[3]=s("label",{for:"email"},"Email",-1)),_(s("input",{id:"email","onUpdate:modelValue":a[1]||(a[1]=n=>o.value=n),type:"email",placeholder:"Enter your email",class:"form-input"},null,512),[[y,o.value]])]),s("div",K,[a[4]||(a[4]=s("label",{for:"avatar"},"Profile Picture",-1)),s("div",G,[s("img",{src:f.value||w,alt:"Profile Picture Preview",class:"avatar-preview"},null,8,H),s("input",{id:"avatar",type:"file",accept:"image/*",onChange:C,class:"avatar-input"},null,32)])]),s("div",J,[s("button",{disabled:!D.value,onClick:I,class:"save-btn"}," Save Changes ",8,O),s("button",{onClick:F,class:"cancel-btn"},"Cancel")])])):(v(),c("div",R,"Failed to load profile. Please try again."))]))}},ee=S(W,[["__scopeId","data-v-0ff88c04"]]);export{ee as default};
