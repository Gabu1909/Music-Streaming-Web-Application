import{_ as N,c as l,o as r,a as n,r as M,t as I,g as R,h as u,j as U,k as K,l as p,b as y,f as L,m as x,d as h,p as B,F as E,q as T,n as j}from"./index-BH3AGQtF.js";import{S as W}from"./SongCard-C3pc5isg.js";/* empty css                                                                     */import{A as H}from"./AlbumCard-BOcrsBrV.js";import{S as Y}from"./song.service-BEFtWEPn.js";const q="/assets/banner-BUcSJjlm.jpg",G={},J={class:"banner rounded mb-4",style:{height:"200px",background:"url('../../uploads/img/banner.jpg') center/cover"}};function Q(b,s){return r(),l("div",J)}const X=N(G,[["render",Q]]),Z={name:"SectionContainer",props:{title:String}},tt={class:"section-container mb-5"},et={class:"section-title mb-4"};function at(b,s,c,v,_,O){return r(),l("section",tt,[n("h2",et,I(c.title),1),M(b.$slots,"default",{},void 0)])}const D=N(Z,[["render",at],["__scopeId","data-v-039e23ad"]]),rt={class:"home-view"},it={key:0,class:"text-center py-5"},nt={key:1,class:"alert alert-danger mx-3",role:"alert"},lt={key:2},st={class:"row"},ot={class:"release-tabs mb-4"},ct={class:"row"},ut={class:"row"},dt={key:3,class:"text-center py-5"},mt={__name:"Home",setup(b){const s=R(),c=u([]),v=u([]),_=u([]),O=u([]),g=u([]),S=u(!0),k=u(null),d=u("all"),$=U(()=>s.state.currentSong?.id),z=async()=>{try{S.value=!0;const t=await Y.getSongs();c.value=t.data?.songs||t.songs||[],console.log("Fetched songs:",c.value),F()}catch(t){console.error("Error fetching songs:",t),k.value="Không thể tải dữ liệu bài hát"}finally{S.value=!1}},F=()=>{if(!Array.isArray(c.value)||!c.value.length)return;const t=[...c.value].sort(()=>Math.random()-.5);v.value=t.slice(0,8);const a=[...c.value].sort((i,o)=>{const A=new Date(i.createdAt||i.created_at||i.updated_at||0);return new Date(o.createdAt||o.created_at||o.updated_at||0)-A});let e=a;d.value==="vietnam"?e=a.filter(i=>f(i.title)||f(m(i))):d.value==="international"&&(e=a.filter(i=>!f(i.title)&&!f(m(i)))),_.value=e.slice(0,6),O.value=t.slice(8,14),g.value=t.slice(14,20)},f=t=>t?/[àáạảãâầấậẩẫăằắặẳẵèéẹẻẽêềếệểễìíịỉĩòóọỏõôồốộổỗơờớợởỡùúụủũưừứựửữỳýỵỷỹđ]/i.test(t):!1,C=t=>{d.value=t,F()},V=t=>{if(!t)return"0:00";if(typeof t=="string"&&t.includes(":"))return t;const a=Math.floor(t/60),e=Math.floor(t%60);return`${a}:${e.toString().padStart(2,"0")}`},P=t=>{if(!t)return null;if(t.image_url)return t.image_url;if(t.thumbnail)return t.thumbnail;if(t.album&&t.album.cover_url)return t.album.cover_url;if(t.artist){if(t.artist.avatar_url)return t.artist.avatar_url;if(t.artist.image_url)return t.artist.image_url}return"/uploads/img/default-cover.jpg"},m=t=>Array.isArray(t.artists)&&t.artists.length>0?t.artists.map(a=>a.name||"Unknown").join(", "):typeof t.artist=="string"?t.artist:t.artist&&t.artist.name?t.artist.name:"Unknown Artist",w=async t=>{try{const a=t.song_id||t.id;if(s.currentTrack?.id===a)return s.togglePlay();const e=await s.normalizeSongData({...t,artist:typeof t.artist=="string"?t.artist:t.artists?.map(o=>o.name).join(", ")}),i=(await Promise.all(c.value.map(o=>s.normalizeSongData({...o,artist:typeof o.artist=="string"?o.artist:o.artists?.map(A=>A.name).join(", ")})))).filter(Boolean);await s.playSong(e,i)}catch(a){console.error("Error playing song:",a)}};return K(()=>{z()}),(t,a)=>(r(),l("div",rt,[p(X,{title:"Chào mừng trở lại",subtitle:"Hàng ngàn bài hát đang chờ bạn khám phá",background:y(q),gradient:"linear-gradient(to right, #6a11cb, #2575fc)"},null,8,["background"]),S.value?(r(),l("div",it,a[3]||(a[3]=[n("div",{class:"spinner-border text-primary",role:"status"},[n("span",{class:"visually-hidden"},"Đang tải...")],-1),n("p",{class:"mt-2"},"Đang tải dữ liệu...",-1)]))):k.value?(r(),l("div",nt,[L(I(k.value)+" ",1),n("button",{onClick:z,class:"btn btn-outline-danger btn-sm ms-2"}," Thử lại ")])):(r(),l("div",lt,[v.value.length>0?(r(),x(D,{key:0,title:"TOP SONGS OF WEEK"},{default:B(()=>[n("div",st,[(r(!0),l(E,null,T(v.value,e=>(r(),l("div",{key:e.id||e._id,class:"col-lg-3 col-md-4 col-6 mb-4"},[p(W,{title:e.title||e.name,artist:m(e),image_url:P(e),duration:V(e.duration),"song-data":e,"is-playing":$.value===(e.id||e._id)&&y(s).state.isPlaying,onPlay:i=>w(e)},null,8,["title","artist","image_url","duration","song-data","is-playing","onPlay"])]))),128))])]),_:1})):h("",!0),_.value.length>0?(r(),x(D,{key:1,title:"NEW RELEASE"},{default:B(()=>[n("div",ot,[n("button",{class:j(["tab",{active:d.value==="all"}]),onClick:a[0]||(a[0]=e=>C("all"))}," Tất Cả ",2),n("button",{class:j(["tab",{active:d.value==="vietnam"}]),onClick:a[1]||(a[1]=e=>C("vietnam"))}," Việt Nam ",2),n("button",{class:j(["tab",{active:d.value==="international"}]),onClick:a[2]||(a[2]=e=>C("international"))}," Quốc Tế ",2)]),n("div",ct,[(r(!0),l(E,null,T(_.value,(e,i)=>(r(),l("div",{key:e.id||e._id,class:"col-md-2 col-6 mb-3"},[p(H,{title:e.title||e.name,artist:m(e),cover_url:P(e),badge:i<3?"Mới":"Hot","song-data":e,"is-playing":$.value===(e.id||e._id)&&y(s).state.isPlaying,onPlay:o=>w(e)},null,8,["title","artist","cover_url","badge","song-data","is-playing","onPlay"])]))),128))])]),_:1})):h("",!0),g.value.length>0?(r(),x(D,{key:2,title:"FOR YOU FOR TODAY"},{default:B(()=>[n("div",ut,[(r(!0),l(E,null,T(g.value,e=>(r(),l("div",{key:e.id||e._id,class:"col-md-2 col-6 mb-3"},[p(H,{title:e.title||e.name,artist:m(e),cover_url:P(e),"song-data":e,"is-playing":$.value===(e.id||e._id)&&y(s).state.isPlaying,onPlay:i=>w(e)},null,8,["title","artist","cover_url","song-data","is-playing","onPlay"])]))),128))])]),_:1})):h("",!0),c.value.length===0?(r(),l("div",dt,a[4]||(a[4]=[n("i",{class:"bi bi-music-note-list",style:{"font-size":"4rem",color:"#ccc"}},null,-1),n("h4",{class:"mt-3 text-muted"},"Chưa có bài hát nào",-1),n("p",{class:"text-muted"},"Hãy thêm một số bài hát vào thư viện của bạn",-1)]))):h("",!0)]))]))}},bt=N(mt,[["__scopeId","data-v-bf50021e"]]);export{bt as default};
